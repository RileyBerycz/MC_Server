name: Launch Minecraft Server

on:
  workflow_dispatch:
    inputs:
      memory:
        description: 'Memory allocation for Java (e.g. 1024M, 2G)'
        default: '1024M'
        required: false
      
jobs:
  start-minecraft-server:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
        
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.9'
          
      - name: Set up Java
        uses: actions/setup-java@v2
        with:
          distribution: 'adopt'
          java-version: '17'
          
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pyngrok

      - name: Download Minecraft Server if needed
        run: |
          if [ ! -f "server.jar" ]; then
            echo "Downloading Minecraft server jar..."
            curl -o server.jar https://piston-data.mojang.com/v1/objects/8f3112a1049751cc472ec13e397eade5336ca7ae/server.jar
          fi
          
      - name: Accept EULA
        run: |
          echo "eula=true" > eula.txt
          
      - name: Launch Minecraft Server
        run: python Start_Server.py
        env:
          JAVA_ARGS: "-Xmx${{ github.event.inputs.memory || '1024M' }} -Xms${{ github.event.inputs.memory || '1024M' }}"
          NGROK_AUTH_TOKEN: ${{ secrets.NGROK_AUTH_TOKEN }}
          MINECRAFT_JAR: "server.jar"
          MINECRAFT_PORT: "25565"